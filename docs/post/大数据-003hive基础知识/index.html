<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>大数据003hive基础知识 | Liuzhongzhen的博客</title>
    <meta property="og:title" content="大数据003hive基础知识 - Liuzhongzhen的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2016-03-01T23:05:23&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2016-03-01T23:05:23&#43;08:00'>
        
    <meta name="Keywords" content="java python php sql">
    <meta name="description" content="大数据003hive基础知识">
        
    <meta name="author" content="liuzhongzhen">
    <meta property="og:url" content="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-003hive%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
    <link rel="shortcut icon" href='../../favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='../../css/normalize.css'>
    <link rel="stylesheet" href='../../css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='../../css/douban.css'>
    
        <link rel="stylesheet" href='../../css/other.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://liuzhongzhen.github.io/">
                        Liuzhongzhen的博客
                    </a>
                
                <p class="description">专注于大数据平台架构，平台开发、数据开发与分析、数据产品建设</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://liuzhongzhen.github.io/">首页</a>
                    
                    <a  href="https://liuzhongzhen.github.io/leetcode/" title="leetcode">leetcode</a>
                    
                    <a  href="https://liuzhongzhen.github.io/books/" title="读书">读书</a>
                    
                    <a  href="https://liuzhongzhen.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://liuzhongzhen.github.io/about/" title="关于">关于</a>
                    
                    <a  href="https://liuzhongzhen.github.io/products/" title="作品">作品</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1什么是hive">1.什么是Hive</a></li>
    <li><a href="#2hive架构">2.Hive架构</a></li>
    <li><a href="#3hive优点">3.Hive优点</a></li>
    <li><a href="#4hive使用场景">4.Hive使用场景</a></li>
    <li><a href="#5hive的执行流程">5.Hive的执行流程</a></li>
    <li><a href="#6sql转化成mapreduce过程">6.SQL转化成MapReduce过程</a></li>
    <li><a href="#7hive的数据模型">7.Hive的数据模型</a>
      <ul>
        <li><a href="#数据模型组成及应用场景">数据模型组成及应用场景</a></li>
      </ul>
    </li>
    <li><a href="#8hive中的文件格式">8.Hive中的文件格式</a>
      <ul>
        <li><a href="#1-textfile行存储">1. TEXTFILE,行存储</a></li>
        <li><a href="#2-sequencefile行存储">2. SequenceFile,行存储</a></li>
        <li><a href="#3-rcfile">3. RCFILE</a></li>
        <li><a href="#4-orcfile">4. orcfile</a></li>
        <li><a href="#5-parquet">5. parquet</a></li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#hive支持的压缩格式">Hive支持的压缩格式</a></li>
    <li><a href="#hive内外表区分方法">Hive内外表区分方法</a></li>
    <li><a href="#hive内外表特点">Hive内外表特点</a>
      <ul>
        <li><a href="#内部表">内部表：</a></li>
        <li><a href="#外部表">外部表：</a></li>
      </ul>
    </li>
    <li><a href="#hive视图特点">Hive视图特点</a></li>
    <li><a href="#hive视图创建">Hive视图创建</a>
      <ul>
        <li><a href="#创建视图">创建视图</a></li>
        <li><a href="#删除视图">删除视图</a></li>
        <li><a href="#修改视图">修改视图</a></li>
      </ul>
    </li>
    <li><a href="#hive视图应用场景">Hive视图应用场景</a></li>
    <li><a href="#hive常用命令及作用">Hive常用命令及作用</a></li>
    <li><a href="#hive常用的10个系统函数及作用">Hive常用的10个系统函数及作用</a>
      <ul>
        <li><a href="#聚合函数">聚合函数</a></li>
        <li><a href="#窗口分析函数">窗口分析函数</a></li>
        <li><a href="#字符串连接函数">字符串连接函数</a></li>
        <li><a href="#其他函数">其他函数</a></li>
      </ul>
    </li>
    <li><a href="#udf">UDF</a>
      <ul>
        <li><a href="#背景">背景</a></li>
        <li><a href="#意义">意义</a></li>
        <li><a href="#实现步骤java创建自定义udf类">实现步骤(Java创建自定义UDF类)</a></li>
        <li><a href="#代码实现">代码实现</a></li>
      </ul>
    </li>
    <li><a href="#udaf">UDAF</a>
      <ul>
        <li><a href="#inputoutput要求-要解决的问题">Input/Output要求-要解决的问题</a></li>
        <li><a href="#实现步骤">实现步骤</a></li>
      </ul>
    </li>
    <li><a href="#udtf">UDTF</a></li>
    <li><a href="#hive设置配置参数的方法">Hive设置配置参数的方法</a>
      <ul>
        <li><a href="#hive-sitexml配置参数">hive-site.xml配置参数</a></li>
        <li><a href="#命令行参数">命令行参数</a></li>
        <li><a href="#进入cli时候声明">进入cli时候声明</a></li>
      </ul>
    </li>
    <li><a href="#8个常用的配置参数">8个常用的配置参数</a></li>
    <li><a href="#数据倾斜产生的原因">数据倾斜产生的原因</a>
      <ul>
        <li><a href="#1hive倾斜之group-by聚合倾斜">1.Hive倾斜之group by聚合倾斜</a></li>
        <li><a href="#2hive倾斜之map和reduce优化">2.Hive倾斜之Map和Reduce优化</a></li>
        <li><a href="#3hive倾斜之hql中包含countdistinct时">3.Hive倾斜之HQL中包含count(distinct)时</a></li>
        <li><a href="#4hive倾斜之hql中join优化">4.Hive倾斜之HQL中join优化</a></li>
        <li><a href="#5合理设置map数">5.合理设置Map数</a></li>
      </ul>
    </li>
    <li><a href="#hive优化策略">Hive优化策略</a>
      <ul>
        <li><a href="#1配置优化">1.配置优化</a></li>
        <li><a href="#2hive表优化">2.Hive表优化</a></li>
        <li><a href="#3hive数据倾斜解决">3.Hive数据倾斜解决</a></li>
      </ul>
    </li>
    <li><a href="#hive中传入变量的方式">Hive中传入变量的方式</a>
      <ul>
        <li><a href="#hive接收外部变量方式详解">hive接收外部变量方式详解</a></li>
        <li><a href="#1-shell中设置变量hive--e中直接使用">1-shell中设置变量，hive -e中直接使用</a></li>
        <li><a href="#2使用-hiveconf定义在sql文件中使用">2.使用-hiveconf定义，在SQL文件中使用</a></li>
        <li><a href="#3使用hivevar再sql文件中使用">3.使用hivevar，再sql文件中使用</a></li>
      </ul>
    </li>
    <li><a href="#hive动态分区参数配置">Hive动态分区参数配置</a>
      <ul>
        <li><a href="#使用动态分区表必须配置的参数">使用动态分区表必须配置的参数</a></li>
        <li><a href="#动态分区相关调优参数">动态分区相关调优参数</a></li>
      </ul>
    </li>
    <li><a href="#动态分区表实践">动态分区表实践</a>
      <ul>
        <li><a href="#1创建单一字段分区表">1.创建单一字段分区表</a></li>
        <li><a href="#2单个字段的动态分区">2.单个字段的动态分区</a></li>
        <li><a href="#3多个分区字段实现半自动分区">3.多个分区字段，实现半自动分区</a></li>
        <li><a href="#4多个分区字段全部实现动态分区插入">4.多个分区字段，全部实现动态分区插入</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">大数据003hive基础知识</h1>
        </header>
        <date class="post-meta meta-date">
            2016年3月1日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='../../categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-003hive'>大数据-003hive</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <p><a href="https://www.jianshu.com/p/b0b77b045fab">转载外部-数仓-hive核心知识点</a></p>
<h2 id="1什么是hive">1.什么是Hive</h2>
<p>Hive是由Facebook开源用于解决海量结构化日志的数据统计；Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射 成一张表，并提供类SQL查询功能，底层计算引擎默认为Hadoop的MapReduce（本质是将sql转化成mapreduce程序），可以将引擎更换为Spark/Tez；</p>
<h2 id="2hive架构">2.Hive架构</h2>
<p>
        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a01.png" />   
    </p>
<p>如图中所示，Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将执行返回的结果输出到用户交互接口。</p>
<ol>
<li>
<p>用户接口：Client</p>
<p>CLI（hive shell）、JDBC/ODBC(java访问hive)、WEBUI（浏览器访问hive）</p>
</li>
<li>
<p>元数据：Metastore</p>
<p>元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等；</p>
<p>默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore</p>
<p>参考Hive元数据表结构</p>
</li>
<li>
<p>Hadoop</p>
<p>使用HDFS进行存储，使用MapReduce进行计算。</p>
</li>
<li>
<p>驱动器：Driver</p>
<p>（1）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。</p>
<p>（2）编译器（Physical Plan）：将AST编译生成逻辑执行计划。</p>
<p>（3）优化器（Query Optimizer）：对逻辑执行计划进行优化。</p>
<p>（4）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来说，就是MR/Spark。</p>
</li>
</ol>
<h2 id="3hive优点">3.Hive优点</h2>
<ul>
<li>操作接口采用类SQL语法，提供快速开发的能力(简单、容易上手)；</li>
<li>避免了去写MapReduce，减少开发人员的学习成本；</li>
<li>统一的元数据管理，可与impala/spark等共享元数据；</li>
<li>易扩展(HDFS+MapReduce：可以扩展集群规模；支持自定义函数)；</li>
</ul>
<h2 id="4hive使用场景">4.Hive使用场景</h2>
<ul>
<li>数据的离线处理；比如：日志分析，海量结构化数据离线分析…</li>
<li>Hive的执行延迟比较高，因此hive常用于数据分析的，对实时性要求不高的场合；</li>
<li>Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高。</li>
</ul>
<h2 id="5hive的执行流程">5.Hive的执行流程</h2>
<ol>
<li>HiveQL通过CLI/web UI或者thrift 、 odbc 或 jdbc接口的外部接口提交，</li>
<li>经过complier编译器，运用Metastore中的元数据进行类型检测和语法分析，生成一个逻辑方案(logical plan),</li>
<li>然后通过简单的优化处理，产生一个以有向无环图DAG数据结构形式展现的map-reduce任务。</li>
</ol>
<h2 id="6sql转化成mapreduce过程">6.SQL转化成MapReduce过程</h2>
<p>Hive是如何将SQL转化为MapReduce任务的，整个编译过程分为六个阶段：</p>
<ol>
<li>Antlr定义SQL的语法规则，完成SQL词法，语法解析，将SQL转化为抽象语法树AST Tree；</li>
<li>遍历AST Tree，抽象出查询的基本组成单元QueryBlock；</li>
<li>遍历QueryBlock，翻译为执行操作树OperatorTree；</li>
<li>逻辑层优化器进行OperatorTree变换，合并不必要的ReduceSinkOperator，减少shuffle数据量；</li>
<li>遍历OperatorTree，翻译为MapReduce任务；</li>
<li>物理层优化器进行MapReduce任务的变换，生成最终的执行计划。</li>
</ol>
<p><a href="https://blog.csdn.net/qq_36932624/article/details/81702405">推荐学习博客:hiveSql语句转换成mapreduce</a></p>
<h2 id="7hive的数据模型">7.Hive的数据模型</h2>
<p>
        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a02.png" />   
    </p>
<h3 id="数据模型组成及应用场景">数据模型组成及应用场景</h3>
<p>Hive的数据模型主要有：database、table、partition、bucket四部分；</p>
<h5 id="数据模型之database">数据模型之database</h5>
<p>database：相当于关系型数据库中的命名空间，作用是将数据库应用隔离到不同的数据库模式中，</p>
<p>hive提供了create database dbname、use dbname 以及drop database dbname的语句；</p>
<h4 id="数据模型之table">数据模型之table</h4>
<p>table：表是由存储的数据以及描述表的一些元数据组成。数据存储再分布式文件系统中，元数据存储在关系型数据库中；</p>
<p>hive表分四种：</p>
<ul>
<li>MANGED_TABLE :内部表</li>
<li>EXTERNAL_TABLE：外部表</li>
<li>INDEX_TABLE：索引表</li>
<li>VIRTUAL_VIEW ：视图表</li>
</ul>
<p>查看表的具体信息使用：desc tablename或者 desc formatted tablename</p>
<h4 id="数据模型之partition">数据模型之partition</h4>
<p>hive的分区是根据某列的值进行粗略的划分，每个分区对应HDFS上的一个目录；</p>
<h4 id="数据模型之bucket">数据模型之bucket</h4>
<ul>
<li>要使用hive的分桶功能，首先需要打开hive对痛的控制 set hive.enforce.bucketing=true;</li>
<li>bucket是按照指定值进行hash，每个桶就是表目录里的一个文件</li>
</ul>
<h2 id="8hive中的文件格式">8.Hive中的文件格式</h2>
<h3 id="1-textfile行存储">1. TEXTFILE,行存储</h3>
<ul>
<li>文本格式，Hive的默认格式，数据不压缩，磁盘开销大、数据解析开销大。</li>
<li>对应的hive API为：org.apache.hadoop.mapred.TextInputFormat和org.apache.hive.ql.io.HiveIgnoreKeyTextOutputFormat；</li>
<li>可结合Gzip、Bzip2使用(系统自动检查，执行查询时自动解压)，但是使用这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作</li>
</ul>
<h3 id="2-sequencefile行存储">2. SequenceFile,行存储</h3>
<ul>
<li>Hadoop提供的二进制文件，Hadoop支持的标准文件；</li>
<li>数据直接序列化到文件中，SequenceFile文件不能直接查看，可以通过Hadoop fs -text查看；</li>
<li>SequenceFile具有使用方便、可分割、可压缩、可进行切片，压缩支持NONE、RECORD、BLOCK（优先）；</li>
<li>对应hive API：org.apache.hadoop.mapred.SequenceFileInputFormat和org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</li>
</ul>
<h3 id="3-rcfile">3. RCFILE</h3>
<ul>
<li>rcfile是一种行列存储相结合的存储方式，先将数据按行进行分块再按列式存储，保证同一条记录在一个块上，避免读取多个块，有利于数据压缩和快速进行列存储；</li>
<li>对应 hive API为：org.apache.hadoop.hive.ql.io.RCFileInputFormat和org.apache.hadoop.hive.ql.io.RCFileOutputFormat</li>
</ul>
<h3 id="4-orcfile">4. orcfile</h3>
<ul>
<li>orcfile式对rcfile的优化，可以提高hive的读写、数据处理性能、提供更高的压缩效率；</li>
<li>优点：
<ul>
<li>每个task只输出单个文件，减少namenode负载；</li>
<li>支持各种复杂的数据类型，比如：datetime，decima以及复杂类型struct、list、map；</li>
<li>文件中存储了一些轻量级的索引数据；</li>
<li>基于数据类型的块模式压缩：integer类型的列用行程长度编码，string类型的列使用字典编码；</li>
<li>用多个相互独立的recordReaders并行读相同的文件</li>
<li>无需扫描markers即可分割文件</li>
<li>绑定读写所需内存</li>
<li>metadata存储用protocol buffers，支持添加和删除列</li>
</ul>
</li>
</ul>
<h3 id="5-parquet">5. parquet</h3>
<p>Parquet也是一种列式存储，同时具有很好的压缩性能；同时可以减少大量的表扫描和反序列化的时间。</p>
<h3 id="总结">总结</h3>
<ul>
<li>textfile 存储空间消耗比较大，并且压缩的text 无法分割和合并 查询的效率最低,可以直接存储，加载数据的速度最高；</li>
<li>sequencefile 存储空间消耗最大,压缩的文件可以分割和合并 查询效率高，需要通过text文件转化来加载；</li>
<li>orcfile, rcfile存储空间最小，查询的效率最高 ，需要通过text文件转化来加载，加载的速度最低；</li>
<li>parquet格式是列式存储，有很好的压缩性能和表扫描功能；</li>
</ul>
<p>SequenceFile,ORCFile(ORC)，rcfile格式的表不能直接从本地文件导入数据，数据要先导入到textfile格式的表中，然后再从textfile表中导入到SequenceFile,ORCFile(ORC)，rcfile表中。</p>
<h2 id="hive支持的压缩格式">Hive支持的压缩格式</h2>
<p>Hive支持的压缩格式为Gzip、Bzip2、lzo、snappy

        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a03.png" />   
    </p>
<h2 id="hive内外表区分方法">Hive内外表区分方法</h2>
<ol>
<li>查看hive元数据：进入mysql中hive元数据库，查看TBLS表，查看对应的表名和表类型；</li>
<li>在hive-cli界面：desc extended tablename，查看TableType，一般在展示结果的最后显示；</li>
<li>在hive-cli界面：desc formatted tablename，一个格式化的信息，查看TableType；</li>
</ol>
<h2 id="hive内外表特点">Hive内外表特点</h2>
<h3 id="内部表">内部表：</h3>
<ul>
<li>hive创建表的时候默认是MANAGED_TABLE:内部表</li>
<li>hive创建表的时候如果指定location，当进行load操作的时候，hdfs上的原始数据会迁移到location指定的目录下；如果创建表的时候没有指定location，数据会迁移到hive-site.xml中配置好的数据存储路径；</li>
<li>hive内部表删除表的时候会将hdfs目录的数据和元数据信息全部删除；</li>
</ul>
<h3 id="外部表">外部表：</h3>
<ul>
<li>创建外部表的时候需要指定location的位置；</li>
<li>hive删除表的时候只会讲元数据信息删除，并不会删除HDFS上的数据；</li>
<li>生成环境中，建议使用hive外部表；</li>
</ul>
<h2 id="hive视图特点">Hive视图特点</h2>
<ul>
<li>View是逻辑存在，Hive暂不支持物化视图(1.0.3)</li>
<li>View只读，不支持LOAD/INSERT/ALTER。需要改变View定义，可以是用Alter View</li>
<li>View内可能包含ORDER BY/LIMIT语句，假如一个针对view的查询也包含这些语句， 则view中的语句优先级高。例如，定义view数据为limit 10， 针对view的查询limit 20，则最多返回10条数据。</li>
<li>Hive支持迭代视图。</li>
<li>Hive中视图的查询和普通查询类似，查询时把表名更换为视图名即可。</li>
</ul>
<h2 id="hive视图创建">Hive视图创建</h2>
<p>视图view和table一样，可以指定database；</p>
<h3 id="创建视图">创建视图</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">CREATE</span> <span style="color:#000;font-weight:bold">VIEW</span> [<span style="color:#000;font-weight:bold">IF</span> <span style="color:#000;font-weight:bold">NOT</span> <span style="color:#000;font-weight:bold">EXISTS</span>] view_name [(<span style="color:#000;font-weight:bold">column_name</span> [<span style="color:#000;font-weight:bold">COMMENT</span> column_comment], ...) ]  
[<span style="color:#000;font-weight:bold">COMMENT</span> view_comment]  
[TBLPROPERTIES (property_name <span style="color:#000;font-weight:bold">=</span> property_value, ...)]  
<span style="color:#000;font-weight:bold">AS</span> <span style="color:#000;font-weight:bold">SELECT</span> ... 
</code></pre></td></tr></table>
</div>
</div><h3 id="删除视图">删除视图</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">DROP</span> <span style="color:#000;font-weight:bold">VIEW</span> [<span style="color:#000;font-weight:bold">IF</span> <span style="color:#000;font-weight:bold">EXISTS</span>] view_name 
</code></pre></td></tr></table>
</div>
</div><h3 id="修改视图">修改视图</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">ALTER</span> <span style="color:#000;font-weight:bold">VIEW</span> view_name <span style="color:#000;font-weight:bold">SET</span> TBLPROPERTIES table_properties  
table_properties:  
  : (property_name <span style="color:#000;font-weight:bold">=</span> property_value, property_name <span style="color:#000;font-weight:bold">=</span> property_value, ...) 
</code></pre></td></tr></table>
</div>
</div><h2 id="hive视图应用场景">Hive视图应用场景</h2>
<ul>
<li>数据仓库中维度角色扮演和维度子维度时可以采用视图的方式保证维度的一致性；</li>
<li>当Hive中的查询变得很长或复杂时，通过视图将这个查询语句分割成多个小的、更可控的片段可以降低这种复杂度；</li>
<li>Hive中需要通过视图限制基于条件过滤的数据时；</li>
</ul>
<h2 id="hive常用命令及作用">Hive常用命令及作用</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#099">1</span>. <span style="color:#a61717;background-color:#e3d2d2">创建表</span>
<span style="color:#998;font-style:italic">-- 内部表
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span> <span style="color:#000;font-weight:bold">table</span> aa(
  col1 string,
  col2 <span style="color:#0086b3">int</span>
) 
partitioned <span style="color:#000;font-weight:bold">by</span>(
  statdate <span style="color:#0086b3">int</span>
) 
<span style="color:#000;font-weight:bold">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span style="color:#000;font-weight:bold">BY</span> <span style="color:#d14">&#39;\t&#39;</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#998;font-style:italic">-- 外部表
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">create</span> <span style="color:#000;font-weight:bold">external</span> <span style="color:#000;font-weight:bold">table</span> bb(
  col1 string, 
  col2 <span style="color:#0086b3">int</span>
) 
partitioned <span style="color:#000;font-weight:bold">by</span>(
  statdate <span style="color:#0086b3">int</span>
) 
<span style="color:#000;font-weight:bold">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span style="color:#000;font-weight:bold">BY</span> <span style="color:#d14">&#39;\t&#39;</span> 
<span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">&#39;/user/gaofei.lu/&#39;</span>;

<span style="color:#099">2</span>. <span style="color:#a61717;background-color:#e3d2d2">查看创建表语句</span>
<span style="color:#000;font-weight:bold">show</span> <span style="color:#000;font-weight:bold">create</span> <span style="color:#000;font-weight:bold">table</span> tablename;

<span style="color:#099">3</span>. <span style="color:#a61717;background-color:#e3d2d2">导入表数据</span>
<span style="color:#a61717;background-color:#e3d2d2">本地数据：</span>
<span style="color:#000;font-weight:bold">load</span> <span style="color:#000;font-weight:bold">data</span> <span style="color:#000;font-weight:bold">local</span> inpath <span style="color:#d14">&#39;/home/gaofei.lu/aa.txt&#39;</span> 
  <span style="color:#000;font-weight:bold">into</span> <span style="color:#000;font-weight:bold">table</span> aa partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170403</span>)

hdfs上数据<span style="color:#a61717;background-color:#e3d2d2">：</span>
<span style="color:#000;font-weight:bold">load</span> <span style="color:#000;font-weight:bold">data</span> inpath <span style="color:#d14">&#39;/user/gaofei.lu/aa.txt&#39;</span> 
  <span style="color:#000;font-weight:bold">into</span> <span style="color:#000;font-weight:bold">table</span> bb partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170403</span>)

<span style="color:#099">4</span>. <span style="color:#a61717;background-color:#e3d2d2">修改表属性</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa <span style="color:#000;font-weight:bold">set</span> tblproperties (<span style="color:#d14">&#39;EXTERNAL&#39;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;TRUE&#39;</span>)
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> bb <span style="color:#000;font-weight:bold">set</span> tblproperties (<span style="color:#d14">&#39;EXTERNAL&#39;</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;FALSE&#39;</span>)

<span style="color:#099">5</span>. <span style="color:#a61717;background-color:#e3d2d2">修改列</span>
<span style="color:#a61717;background-color:#e3d2d2">修改列名和列数据类型：</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa change col2 name string;

<span style="color:#a61717;background-color:#e3d2d2">修改位置放置第一位：</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa change col2 name string <span style="color:#000;font-weight:bold">first</span>;

<span style="color:#a61717;background-color:#e3d2d2">修改位置指定某一列后面：</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa change col1 dept string <span style="color:#000;font-weight:bold">after</span> name;

<span style="color:#099">6</span>. <span style="color:#a61717;background-color:#e3d2d2">添加列</span>(<span style="color:#a61717;background-color:#e3d2d2">慎用</span>)
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa <span style="color:#000;font-weight:bold">add</span> columns(col3 string);

<span style="color:#099">7</span>. <span style="color:#a61717;background-color:#e3d2d2">表重命名</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa <span style="color:#000;font-weight:bold">rename</span> <span style="color:#000;font-weight:bold">to</span> aa_test;

<span style="color:#099">8</span>. <span style="color:#a61717;background-color:#e3d2d2">添加分区</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa <span style="color:#000;font-weight:bold">add</span> partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170404</span>);
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> bb <span style="color:#000;font-weight:bold">add</span> partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170404</span>) 
  <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">&#39;/user/gaofei.lu/20170404.txt&#39;</span>;

<span style="color:#099">9</span>. <span style="color:#a61717;background-color:#e3d2d2">查看表分区</span>
<span style="color:#000;font-weight:bold">show</span> partitioins aa;

<span style="color:#099">10</span>. <span style="color:#a61717;background-color:#e3d2d2">修改分区</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170404</span>) <span style="color:#000;font-weight:bold">rename</span> <span style="color:#000;font-weight:bold">to</span> partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170405</span>);
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> bb partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170404</span>) <span style="color:#000;font-weight:bold">set</span> <span style="color:#000;font-weight:bold">location</span> <span style="color:#d14">&#39;/user/gaofei.lu/aa.txt&#39;</span>;

<span style="color:#099">11</span>. <span style="color:#a61717;background-color:#e3d2d2">删除分区</span>
<span style="color:#000;font-weight:bold">alter</span> <span style="color:#000;font-weight:bold">table</span> aa <span style="color:#000;font-weight:bold">drop</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">exists</span> partition(statdate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">20170404</span>);

<span style="color:#099">12</span>. beeline连接
beeline  <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">connect</span> jdbc:hive2:<span style="color:#000;font-weight:bold">//</span><span style="color:#099">192</span>.<span style="color:#099">168</span>.<span style="color:#099">1</span>.<span style="color:#099">17</span>:<span style="color:#099">10000</span>

<span style="color:#099">13</span>. <span style="color:#a61717;background-color:#e3d2d2">设置</span>hive <span style="color:#000;font-weight:bold">on</span> spark
<span style="color:#000;font-weight:bold">set</span> hive.execution.engine<span style="color:#000;font-weight:bold">=</span>spark

<span style="color:#099">14</span>. <span style="color:#a61717;background-color:#e3d2d2">终止任务</span>
yarn application <span style="color:#000;font-weight:bold">-</span>kill job_id

<span style="color:#099">15</span>. <span style="color:#a61717;background-color:#e3d2d2">指定分隔符导出文件</span>
<span style="color:#000;font-weight:bold">insert</span> overwrite <span style="color:#000;font-weight:bold">local</span> directory <span style="color:#d14">&#39;/home/hadoop/gaofeilu/test_delimited.txt&#39;</span>
   <span style="color:#000;font-weight:bold">row</span> format delimited
fields terminated <span style="color:#000;font-weight:bold">by</span> <span style="color:#d14">&#39;\t&#39;</span>
<span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">from</span> test;
</code></pre></td></tr></table>
</div>
</div><h2 id="hive常用的10个系统函数及作用">Hive常用的10个系统函数及作用</h2>
<h3 id="聚合函数">聚合函数</h3>
<p>函数处理的数据粒度为多条记录。</p>
<ul>
<li>sum()—求和</li>
<li>count()—求数据量</li>
<li>avg()—求平均直</li>
<li>distinct—求不同值数</li>
<li>min—求最小值</li>
<li>max—求最人值</li>
</ul>
<h3 id="窗口分析函数">窗口分析函数</h3>
<ul>
<li>RANK</li>
<li>ROW_NUMBER</li>
<li>DENSE_RANK</li>
<li>CUME_DIST</li>
<li>PERCENT_RANK</li>
</ul>
<h3 id="字符串连接函数">字符串连接函数</h3>
<ul>
<li>concat</li>
<li>concat_ws</li>
<li>collect_list</li>
<li>collect_set</li>
</ul>
<h3 id="其他函数">其他函数</h3>
<ul>
<li>cast -类型转换</li>
<li>if判断 &ndash; if(con,'','');</li>
</ul>
<h2 id="udf">UDF</h2>
<p>User-Defined-Function 自定义函数 、一进一出；</p>
<h3 id="背景">背景</h3>
<p>系统内置函数无法解决实际的业务问题，需要开发者自己编写函数实现自身的业务实现诉求。</p>
<p>应用场景非常多，面临的业务不同导致个性化实现很多，故udf很需要。</p>
<h3 id="意义">意义</h3>
<p>函数扩展得到解决，极大丰富了可定制化的业务需求。</p>
<p>IO要求-要解决的问题</p>
<ul>
<li>in:out=1:1,只能输入一条记录当中的数据，同时返回一条处理结果。</li>
<li>属于最常见的自定义函数，像cos,sin,substring,indexof等均是如此要求</li>
</ul>
<h3 id="实现步骤java创建自定义udf类">实现步骤(Java创建自定义UDF类)</h3>
<ul>
<li>自定义一个java类</li>
<li>继承UDF类</li>
<li>重写evaluate方法</li>
<li>打包类所在项目成一个all-in-one的jar包并上传到hive所在机器</li>
<li>在hive中执行add jar操作，将jar加载到classpath中。</li>
<li>在hive中创建模板函数，使得后边可以使用该函数名称调用实际的udf函数</li>
<li>hive sql中像调用系统函数一样使用udf函数</li>
</ul>
<h3 id="代码实现">代码实现</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">功能要求<span style="color:#a61717;background-color:#e3d2d2">：</span>实现当输入字符串超过2个字符的时候<span style="color:#a61717;background-color:#e3d2d2">，</span>多余的字符以<span style="color:#a61717;background-color:#e3d2d2">”…”</span>来表示<span style="color:#a61717;background-color:#e3d2d2">。</span>
如<span style="color:#a61717;background-color:#e3d2d2">“</span>12<span style="color:#a61717;background-color:#e3d2d2">”</span>则返回<span style="color:#a61717;background-color:#e3d2d2">“</span>12<span style="color:#a61717;background-color:#e3d2d2">”，</span>如<span style="color:#a61717;background-color:#e3d2d2">“</span>123<span style="color:#a61717;background-color:#e3d2d2">”</span>返回<span style="color:#a61717;background-color:#e3d2d2">“</span>12<span style="color:#a61717;background-color:#e3d2d2">…”</span>
自定义类<span style="color:#a61717;background-color:#e3d2d2">、</span>继承UDF<span style="color:#a61717;background-color:#e3d2d2">、</span>重写evaluate方法已在代码中体现

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.hadoop.hive.ql.exec.UDF</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic"> * 功能：实现当输入字符串超过2个字符的时候，多余的字符以&#34;...&#34;来表示。
</span><span style="color:#998;font-style:italic"> * 输入/输出：* 如“12”则返回“12”，如“123”返回“12...&#34;
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ValueMaskUDF</span> <span style="color:#000;font-weight:bold">extends</span> UDF<span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">evaluate</span><span style="color:#000;font-weight:bold">(</span>String input<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span> maxSaveStringLength<span style="color:#000;font-weight:bold">,</span>String replaceSign<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>input<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">()&lt;=</span>maxSaveStringLength<span style="color:#000;font-weight:bold">){</span>
          <span style="color:#000;font-weight:bold">return</span> input<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">return</span> input<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">,</span>maxSaveStringLength<span style="color:#000;font-weight:bold">)+</span>replaceSign<span style="color:#000;font-weight:bold">;</span>
  <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> ValueMaskUDF<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;河北省&#34;</span><span style="color:#000;font-weight:bold">,</span>2<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;...&#34;</span><span style="color:#000;font-weight:bold">));;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="udaf">UDAF</h2>
<p>自定义udaf函数self_count，实现系统udaf count的功能</p>
<h3 id="inputoutput要求-要解决的问题">Input/Output要求-要解决的问题</h3>
<ul>
<li>in:out=n:1,即接受输入N条记录当中的数据，同时返回一条处理结果。</li>
<li>属于最常见的自定义函数，像count,sum,avg,max等均是如此要求</li>
</ul>
<h3 id="实现步骤">实现步骤</h3>
<ul>
<li>自定义一个java类</li>
<li>继承UDAF类</li>
<li>内部定义一个静态类，实现UDAFEvaluator接口</li>
<li>实现方法init,iterate,terminatePartial,merge,terminate，共5个方法. 详见下图</li>
<li>在hive中执行add jar操作，将jar加载到classpath中。</li>
<li>在hive中创建模板函数，使得后边可以使用该函数名称调用实际的udf函数</li>
<li>hive sql中像调用系统函数一样使用udaf函数</li>
</ul>
<p>
        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a04.png" />   
    
业务测试</p>
<ul>
<li>输入：

        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a05.png" />   
    </li>
<li>输出

        <img class="mx-auto" alt="bigdata" src="../../imgs/post/bigdata_hive/a06.png" />   
    </li>
<li>UDAF代码开发</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.HashMap</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Map</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Set</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.hadoop.hive.ql.exec.UDAF</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.hadoop.hive.ql.exec.UDAFEvaluator</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.log4j.Logger</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">* 实现多条数据合并成一条数据
</span><span style="color:#998;font-style:italic">*/</span>
<span style="color:#998;font-style:italic">// 主类继承UDAF
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">StudentScoreAggUDAF</span> <span style="color:#000;font-weight:bold">extends</span> UDAF <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 日志对象初始化
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Logger logger <span style="color:#000;font-weight:bold">=</span> Logger<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getLogger</span><span style="color:#000;font-weight:bold">(</span>StudentScoreAggUDAF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#998;font-style:italic">// 静态类实现UDAFEvaluator
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Evaluator</span> <span style="color:#000;font-weight:bold">implements</span> UDAFEvaluator <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">// 设置成员变量，存储每个统计范围内的总记录数
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">private</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> courseScoreMap<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#998;font-style:italic">//初始化函数,map和reduce均会执行该函数,起到初始化所需要的变量的作用
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Evaluator</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            init<span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#998;font-style:italic">// 初始化函数间传递的中间变量
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">init</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            courseScoreMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;();</span>
        <span style="color:#000;font-weight:bold">}</span>

         <span style="color:#998;font-style:italic">//map阶段，返回值为boolean类型，当为true则程序继续执行，当为false则程序退出  
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">iterate</span><span style="color:#000;font-weight:bold">(</span>String course<span style="color:#000;font-weight:bold">,</span> String score<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>course <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">||</span> score <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            courseScoreMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>course<span style="color:#000;font-weight:bold">,</span> score<span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
         <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">         * 类似于combiner,在map范围内做部分聚合，将结果传给merge函数中的形参mapOutput  
</span><span style="color:#998;font-style:italic">         * 如果需要聚合，则对iterator返回的结果处理，否则直接返回iterator的结果即可
</span><span style="color:#998;font-style:italic">         */</span>
        <span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">terminatePartial</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> courseScoreMap<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
         <span style="color:#998;font-style:italic">// reduce 阶段，用于逐个迭代处理map当中每个不同key对应的 terminatePartial的结果
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">merge</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> mapOutput<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">courseScoreMap</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">putAll</span><span style="color:#000;font-weight:bold">(</span>mapOutput<span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#998;font-style:italic">// 处理merge计算完成后的结果，即对merge完成后的结果做最后的业务处理
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">terminate</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> courseScoreMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>测试sql语句</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">select</span> id,username,score_agg(course,score) 
  <span style="color:#000;font-weight:bold">from</span> student_score 
 <span style="color:#000;font-weight:bold">group</span> <span style="color:#000;font-weight:bold">by</span> id,username;
</code></pre></td></tr></table>
</div>
</div><h2 id="udtf">UDTF</h2>
<ul>
<li>User-Defined Table-Generating Functions</li>
<li>要解决一行输入多行输出的问题，问题的应用场景不少</li>
<li>用udtf解决一行输入多行输出的不多，往往被lateral view explode+udf等替代实现，比直接用udtf会更简单、直接一些</li>
</ul>
<h2 id="hive设置配置参数的方法">Hive设置配置参数的方法</h2>
<p>Hive提供三种可以改变环境变量的方法，分别是：</p>
<ol>
<li>修改${HIVE_HOME}/conf/hive-site.xml配置文件；</li>
<li>命令行参数；</li>
<li>在已经进入cli时进行参数声明。</li>
</ol>
<h3 id="hive-sitexml配置参数">hive-site.xml配置参数</h3>
<p>在Hive中，所有的默认配置都在 &ldquo;{HIVE_HOME}/conf/hive-default.xml &ldquo;文件中，如果需要对默认的配置进行修改，可以创建一个 &ldquo;hive-site.xml&rdquo; 文件，放在 &quot; {HIVE_HOME}/conf&quot;目录下。里面可以对一些配置进行个性化设定。在hive-site.xml的格式如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;configuration&gt;</span>
    <span style="color:#000080">&lt;property&gt;</span>
        <span style="color:#000080">&lt;name&gt;</span>hive.metastore.warehouse.dir<span style="color:#000080">&lt;/name&gt;</span>
        <span style="color:#000080">&lt;value&gt;</span>/user/hive/warehouse<span style="color:#000080">&lt;/value&gt;</span>
        <span style="color:#000080">&lt;description&gt;</span>location of
              default database for the warehouse<span style="color:#000080">&lt;/description&gt;</span>
    <span style="color:#000080">&lt;/property&gt;</span>
<span style="color:#000080">&lt;/configuration&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>所有的配置都是放在<!-- raw HTML omitted --><!-- raw HTML omitted -->标签之间，<br>
一个configuration标签里面可以存在多个<!-- raw HTML omitted --><!-- raw HTML omitted -->标签。<br>
<!-- raw HTML omitted -->标签里面就是我们想要设定属性的名称；<br>
<!-- raw HTML omitted -->标签里面是我们想要设定的值；<br>
<!-- raw HTML omitted -->标签是描述在这个属性的，可以不写。<br>
绝大多少配置都是在xml文件里面配置的，因为在这里做的配置都全局用户都生效，而且是永久的。<br>
用户自定义配置会覆盖默认配置。<br>
另外，Hive也会读入Hadoop的配置，因为Hive是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。</p>
<h3 id="命令行参数">命令行参数</h3>
<p>在启动Hive cli的时候进行配置，可以在命令行添加-hiveconf param=value来设定参数，例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hive --hiveconf mapreduce.job.queuename<span style="color:#000;font-weight:bold">=</span>queue1
</code></pre></td></tr></table>
</div>
</div><p>这样在Hive中所有MapReduce作业都提交到队列queue1中。这一设定对本次启动的会话有效，下次启动需要重新配置。</p>
<h3 id="进入cli时候声明">进入cli时候声明</h3>
<p>在已经进入cli时进行参数声明，可以在HQL中使用SET关键字设定参数，例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0086b3">set</span> mapreduce.job.queuename<span style="color:#000;font-weight:bold">=</span>queue1;
</code></pre></td></tr></table>
</div>
</div><p>上述三种设定方式的优先级依次递增。即参数声明覆盖命令行参数，命令行参数覆盖配置文件设定。</p>
<h2 id="8个常用的配置参数">8个常用的配置参数</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#099">0</span>. hive.<span style="color:#000;font-weight:bold">fetch</span>.task.<span style="color:#000;font-weight:bold">conversion</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">more</span>;<span style="color:#a61717;background-color:#e3d2d2">将</span>hive拉取的模式设置为more模式
<span style="color:#099">1</span>. hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">mode</span>.<span style="color:#000;font-weight:bold">local</span>.auto <span style="color:#a61717;background-color:#e3d2d2">决定</span>Hive是否应该自动地根据输入文件大小,<span style="color:#a61717;background-color:#e3d2d2">在本地运行</span>(<span style="color:#a61717;background-color:#e3d2d2">在</span>GateWay运行)
<span style="color:#099">2</span>. hive.auto.<span style="color:#000;font-weight:bold">convert</span>.<span style="color:#000;font-weight:bold">join</span>:<span style="color:#a61717;background-color:#e3d2d2">是否根据输入小表的大小，自动将</span>Reduce端的CommonJoin转化为MapJoin<span style="color:#a61717;background-color:#e3d2d2">，</span>
                          <span style="color:#a61717;background-color:#e3d2d2">从而加快大表关联小表的</span> <span style="color:#000;font-weight:bold">Join</span> <span style="color:#a61717;background-color:#e3d2d2">速度。</span> <span style="color:#a61717;background-color:#e3d2d2">默认：</span><span style="color:#000;font-weight:bold">false</span><span style="color:#a61717;background-color:#e3d2d2">。</span>
<span style="color:#099">3</span>. mapred.reduce.tasks:<span style="color:#a61717;background-color:#e3d2d2">所提交</span> Job <span style="color:#a61717;background-color:#e3d2d2">的</span> reduer <span style="color:#a61717;background-color:#e3d2d2">的个数，使用</span> Hadoop Client <span style="color:#a61717;background-color:#e3d2d2">的配置。</span> 
                       <span style="color:#a61717;background-color:#e3d2d2">默认是</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">，表示</span>Job执行的个数交由Hive来分配<span style="color:#a61717;background-color:#e3d2d2">；</span>
   mapred.<span style="color:#000;font-weight:bold">map</span>.tasks:   <span style="color:#a61717;background-color:#e3d2d2">设置提交</span>Job的map端个数<span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#099">4</span>. hive.<span style="color:#000;font-weight:bold">map</span>.aggr<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span> <span style="color:#a61717;background-color:#e3d2d2">开启</span>map端聚合<span style="color:#a61717;background-color:#e3d2d2">；</span>
   hive.groupby.skewindata<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>: <span style="color:#a61717;background-color:#e3d2d2">决定</span> <span style="color:#000;font-weight:bold">group</span> <span style="color:#000;font-weight:bold">by</span> <span style="color:#a61717;background-color:#e3d2d2">操作是否支持倾斜的数据。</span>
                       <span style="color:#a61717;background-color:#e3d2d2">原理是，在</span><span style="color:#000;font-weight:bold">Group</span> by中<span style="color:#a61717;background-color:#e3d2d2">，对一些比较小的分区进行合并，默认是</span><span style="color:#000;font-weight:bold">false</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#099">5</span>. hive.merge.mapredfiles: <span style="color:#a61717;background-color:#e3d2d2">是否开启合并</span> <span style="color:#000;font-weight:bold">Map</span><span style="color:#000;font-weight:bold">/</span>Reduce <span style="color:#a61717;background-color:#e3d2d2">小文件，</span>
     <span style="color:#a61717;background-color:#e3d2d2">对于</span> Hadoop <span style="color:#099">0</span>.<span style="color:#099">20</span> <span style="color:#a61717;background-color:#e3d2d2">以前的版本，起一首新的</span> <span style="color:#000;font-weight:bold">Map</span><span style="color:#000;font-weight:bold">/</span>Reduce Job<span style="color:#a61717;background-color:#e3d2d2">，</span>
     <span style="color:#a61717;background-color:#e3d2d2">对于</span> <span style="color:#099">0</span>.<span style="color:#099">20</span> <span style="color:#a61717;background-color:#e3d2d2">以后的版本，则是起使用</span> CombineInputFormat <span style="color:#a61717;background-color:#e3d2d2">的</span> MapOnly Job<span style="color:#a61717;background-color:#e3d2d2">。</span> 
     <span style="color:#a61717;background-color:#e3d2d2">默认是：</span><span style="color:#000;font-weight:bold">false</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#099">6</span>. hive.mapred.<span style="color:#000;font-weight:bold">mode</span>:<span style="color:#000;font-weight:bold">Map</span><span style="color:#000;font-weight:bold">/</span>Redure模式<span style="color:#a61717;background-color:#e3d2d2">，如果设置为</span><span style="color:#000;font-weight:bold">strict</span><span style="color:#a61717;background-color:#e3d2d2">，将不允许笛卡尔积。默认是：</span><span style="color:#d14">&#39;nonstrict&#39;</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#099">7</span>. hive.<span style="color:#000;font-weight:bold">exec</span>.parallel:<span style="color:#a61717;background-color:#e3d2d2">是否开启</span> <span style="color:#000;font-weight:bold">map</span><span style="color:#000;font-weight:bold">/</span>reduce job的并发提交<span style="color:#a61717;background-color:#e3d2d2">。</span>
                      <span style="color:#a61717;background-color:#e3d2d2">默认</span><span style="color:#000;font-weight:bold">Map</span><span style="color:#000;font-weight:bold">/</span>Reduce job是顺序执行的<span style="color:#a61717;background-color:#e3d2d2">，默认并发数量是</span><span style="color:#099">8</span><span style="color:#a61717;background-color:#e3d2d2">，可以配置。</span>
                      <span style="color:#a61717;background-color:#e3d2d2">默认是：</span><span style="color:#000;font-weight:bold">false</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
<span style="color:#099">8</span>. hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span><span style="color:#a61717;background-color:#e3d2d2">：是否打开动态分区。</span> <span style="color:#a61717;background-color:#e3d2d2">需要打开，默认：</span><span style="color:#000;font-weight:bold">false</span><span style="color:#a61717;background-color:#e3d2d2">；</span>
   <span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition.<span style="color:#000;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">=</span>nonstirct
</code></pre></td></tr></table>
</div>
</div><h2 id="数据倾斜产生的原因">数据倾斜产生的原因</h2>
<p>数据倾斜的原因很大部分是join倾斜和聚合倾斜两大类</p>
<h3 id="1hive倾斜之group-by聚合倾斜">1.Hive倾斜之group by聚合倾斜</h3>
<h4 id="原因">原因：</h4>
<ul>
<li>分组的维度过少，每个维度的值过多，导致处理某值的reduce耗时很久；</li>
<li>对一些类型统计的时候某种类型的数据量特别多，其他的数据类型特别少。当按照类型进行group by的时候，会将相同的group by字段的reduce任务需要的数据拉取到同一个节点进行聚合，而当其中每一组的数据量过大时，会出现其他组的计算已经完成而这个reduce还没有计算完成，其他的节点一直等待这个节点的任务执行完成，所以会一直看到map 100% reduce99%的情况；</li>
</ul>
<h4 id="解决方法">解决方法：</h4>
<ul>
<li>set hive.map.aggr=true;</li>
<li>set hive.groupby.skewindata=true;</li>
</ul>
<h4 id="原理">原理：</h4>
<ul>
<li>hive.map.aggr=true 这个配置代表开启map端聚合；</li>
<li>hive.groupby.skewindata=true，当选项设定为true，生成的查询计划会有两个MR Job。当第一个MR Job中，Map的输出结果结合会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果。这样处理的结果是相同的Group By Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的。第二个MR Job再根据预处理的数据结果按照Group By Key分布到reduce中，这个过程可以保证相同的key被分到同一个reduce中，最后完成最终的聚合操作。</li>
</ul>
<h3 id="2hive倾斜之map和reduce优化">2.Hive倾斜之Map和Reduce优化</h3>
<ol>
<li>原因：当出现小文件过多，需要合并小文件。可以通过set hive.merge.mapredfiles=true来解决；</li>
<li>原因：输入数据存在大块和小块的严重问题，比如 说：一个大文件128M，还有1000个小文件，每 个1KB。 解决方法：任务输入前做文件合并，将众多小文件合并成一个大文件。通过set hive.merge.mapredfiles=true解决；</li>
<li>原因：单个文件大小稍稍大于配置的block块的大小，此时需要适当增加map的个数。解决方法：set mapred.map.tasks的个数；</li>
<li>原因：文件大小适中，但是map端计算量非常大，如：select id,count(*),sum(case when&hellip;),sum(case when &hellip;)&hellip;需要增加map个数。解决方法：set mapred.map.tasks个数，set mapred.reduce.tasks个数；</li>
</ol>
<h3 id="3hive倾斜之hql中包含countdistinct时">3.Hive倾斜之HQL中包含count(distinct)时</h3>
<ul>
<li>如果数据量非常大，执行如select a,count(distinct b) from t group by a;类型的sql时，会出现数据倾斜的问题。</li>
<li>解决方法：使用sum&hellip;group by代替。如：select a,sum(1) from(select a,b from t group by a,b) group by a;</li>
</ul>
<h3 id="4hive倾斜之hql中join优化">4.Hive倾斜之HQL中join优化</h3>
<ul>
<li>当遇到一个大表和一个小表进行join操作时。使用mapjoin将小表加载到内存中。如：select /*+ MAPJOIN(a) */ a.c1, b.c1 ,b.c2 from a join b where a.c1 = b.c1;</li>
<li>遇到需要进行join，但是关联字段有数据为null，如表一的id需要和表二的id进行关联；</li>
</ul>
<h4 id="解决方法1id为null的不参与关联">解决方法1：id为null的不参与关联</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">*</span> 
  <span style="color:#000;font-weight:bold">from</span> log a 
  <span style="color:#000;font-weight:bold">join</span> users b 
    <span style="color:#000;font-weight:bold">on</span> a.id <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">and</span> a.id <span style="color:#000;font-weight:bold">=</span> b.id 
<span style="color:#000;font-weight:bold">union</span> <span style="color:#000;font-weight:bold">all</span> 
<span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">*</span> 
  <span style="color:#000;font-weight:bold">from</span> log a 
 <span style="color:#000;font-weight:bold">where</span> a.id <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">null</span>; 
</code></pre></td></tr></table>
</div>
</div><h4 id="解决方法2-给null值分配随机的key值">解决方法2： 给null值分配随机的key值</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">*</span> 
  <span style="color:#000;font-weight:bold">from</span> log a 
  <span style="color:#000;font-weight:bold">left</span> <span style="color:#000;font-weight:bold">outer</span> <span style="color:#000;font-weight:bold">join</span> users b 
    <span style="color:#000;font-weight:bold">on</span> <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">when</span> a.user_id <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">then</span> concat(<span style="color:#a61717;background-color:#e3d2d2">‘</span>hive<span style="color:#a61717;background-color:#e3d2d2">’</span>,rand() ) 
            <span style="color:#000;font-weight:bold">else</span> a.user_id 
       <span style="color:#000;font-weight:bold">end</span> <span style="color:#000;font-weight:bold">=</span> b.user_id; 
</code></pre></td></tr></table>
</div>
</div><h3 id="5合理设置map数">5.合理设置Map数</h3>
<p>对上文描述的总结</p>
<ol>
<li>
<p>通常情况下，作业会通过input的目录产生一个或者多个map任务。</p>
<p>主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。</p>
</li>
<li>
<p>是不是map数越多越好？
答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。</p>
</li>
<li>
<p>是不是保证每个map处理接近128m的文件块，就高枕无忧了？
答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map任务去做，肯定也比较耗时。</p>
</li>
</ol>
<p>针对上面的问题2和3，我们需要采取两种方式来解决：即减少map数和增加map数；</p>
<h2 id="hive优化策略">Hive优化策略</h2>
<p>Hive的优化策略大致分为：配置优化(hive-site.xml和hive-cli执行前配置)、表优化、hive数据倾斜解决方案。</p>
<h3 id="1配置优化">1.配置优化</h3>
<h4 id="afetch抓取配置">a.Fetch抓取配置</h4>
<ul>
<li>Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT * FROM employees;在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，然后输出查询结果到控制台。</li>
<li>在hive-default.xml.template文件中hive.fetch.task.conversion默认是more，老版本hive默认是minimal，该属性修改为more以后，在全局查找、字段查找、limit查找等都不走mapreduce。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;property&gt;</span>
  <span style="color:#000080">&lt;name&gt;</span>hive.fetch.task.conversion<span style="color:#000080">&lt;/name&gt;</span>
  <span style="color:#000080">&lt;value&gt;</span>more<span style="color:#000080">&lt;/value&gt;</span>
  <span style="color:#000080">&lt;description&gt;</span>
    Expects one of [none, minimal, more].
    Some select queries can be converted to single FETCH task minimizing latency.
    Currently the query should be single sourced not having any subquery and should not have
    any aggregations or distincts (which incurs RS), lateral views and joins.
    0. none : disable hive.fetch.task.conversion
    1. minimal : SELECT STAR, FILTER on partition columns, LIMIT only
    2. more  : SELECT, FILTER, LIMIT only (support TABLESAMPLE and virtual columns)
  <span style="color:#000080">&lt;/description&gt;</span>
<span style="color:#000080">&lt;/property&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="b开启hive的本地模式">b.开启Hive的本地模式</h4>
<ul>
<li>大多数的Hadoop Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。</li>
<li>用户可以通过设置hive.exec.mode.local.auto的值为true，来让Hive在适当的时候自动启动这个优化。</li>
</ul>
<h4 id="c开启hive的并行执行">c.开启Hive的并行执行</h4>
<ul>
<li>Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。</li>
<li>通过设置参数hive.exec.parallel值为true，就可以开启并发执行。不过，在共享集群中，需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。</li>
<li>设置参数：
<ul>
<li>set hive.exec.parallel=true; //打开任务并行执行</li>
<li>set hive.exec.parallel.thread.number=16; //同一个sql允许最大并行度，默认为8。</li>
</ul>
</li>
</ul>
<h4 id="dhive的严格模式">d.Hive的严格模式</h4>
<ul>
<li>Hive提供了一个严格模式，可以防止用户执行那些可能意向不到的不好的影响的查询。</li>
<li>通过设置属性hive.mapred.mode值为默认是非严格模式nonstrict 。</li>
</ul>
<p>开启严格模式需要修改hive.mapred.mode值为strict，开启严格模式可以禁止3种类型的查询。</p>
<ol>
<li>对于分区表，除非where语句中含有分区字段过滤条件来限制范围，否则不允许执行。</li>
<li>对于使用了order by语句的查询，要求必须使用limit语句。</li>
<li>限制笛卡尔积的查询。</li>
</ol>
<h4 id="ejvm重用">e.JVM重用</h4>
<ul>
<li>JVM重用是Hadoop调优参数的内容，其对Hive的性能具有非常大的影响，特别是对于很难避免小文件的场景或task特别多的场景，这类场景大多数执行时间都很短。</li>
<li>Hadoop的默认配置通常是使用派生JVM来执行map和Reduce任务的。这时JVM的启动过程可能会造成相当大的开销，尤其是执行的job包含有成百上千task任务的情况。JVM重用可以使得JVM实例在同一个job中重新使用N次。N的值可以在Hadoop的mapred-site.xml文件中进行配置。通常在10-20之间，具体多少需要根据具体业务场景测试得出。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;property&gt;</span>
  <span style="color:#000080">&lt;name&gt;</span>mapreduce.job.jvm.numtasks<span style="color:#000080">&lt;/name&gt;</span>
  <span style="color:#000080">&lt;value&gt;</span>10<span style="color:#000080">&lt;/value&gt;</span>
  <span style="color:#000080">&lt;description&gt;</span>How many tasks to run per jvm. If set to -1, there is
  no limit. 
  <span style="color:#000080">&lt;/description&gt;</span>
<span style="color:#000080">&lt;/property&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>这个功能的缺点是，开启JVM重用将一直占用使用到的task插槽，以便进行重用，直到任务完成后才能释放。如果某个“不平衡的”job中有某几个reduce task执行的时间要比其他Reduce task消耗的时间多的多的话，那么保留的插槽就会一直空闲着却无法被其他的job使用，直到所有的task都结束了才会释放。</li>
</ul>
<h4 id="f开启hive的推测执行">f.开启Hive的推测执行</h4>
<ul>
<li>在分布式集群环境下，因为程序Bug（包括Hadoop本身的bug），负载不均衡或者资源分布不均等原因，会造成同一个作业的多个任务之间运行速度不一致，有些任务的运行速度可能明显慢于其他任务（比如一个作业的某个任务进度只有50%，而其他所有任务已经运行完毕），则这些任务会拖慢作业的整体执行进度。为了避免这种情况发生，Hadoop采用了推测执行（Speculative Execution）机制，它根据一定的法则推测出“拖后腿”的任务，并为这样的任务启动一个备份任务，让该任务与原始任务同时处理同一份数据，并最终选用最先成功运行完成任务的计算结果作为最终结果。</li>
<li>设置开启推测执行参数：Hadoop的mapred-site.xml文件中进行配置</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;property&gt;</span>
  <span style="color:#000080">&lt;name&gt;</span>mapreduce.map.speculative<span style="color:#000080">&lt;/name&gt;</span>
  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
  <span style="color:#000080">&lt;description&gt;</span>If true, then multiple instances of some map tasks 
               may be executed in parallel.<span style="color:#000080">&lt;/description&gt;</span>
<span style="color:#000080">&lt;/property&gt;</span>

<span style="color:#000080">&lt;property&gt;</span>
  <span style="color:#000080">&lt;name&gt;</span>mapreduce.reduce.speculative<span style="color:#000080">&lt;/name&gt;</span>
  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
  <span style="color:#000080">&lt;description&gt;</span>If true, then multiple instances of some reduce tasks 
               may be executed in parallel.<span style="color:#000080">&lt;/description&gt;</span>
<span style="color:#000080">&lt;/property&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>不过hive本身也提供了配置项来控制reduce-side的推测执行：</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;property&gt;</span>
  <span style="color:#000080">&lt;name&gt;</span>hive.mapred.reduce.tasks.speculative.execution<span style="color:#000080">&lt;/name&gt;</span>
  <span style="color:#000080">&lt;value&gt;</span>true<span style="color:#000080">&lt;/value&gt;</span>
  <span style="color:#000080">&lt;description&gt;</span>Whether speculative execution for reducers should be turned on. <span style="color:#000080">&lt;/description&gt;</span>
<span style="color:#000080">&lt;/property&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>关于调优这些推测执行变量，还很难给一个具体的建议。如果用户对于运行时的偏差非常敏感的话，那么可以将这些功能关闭掉。如果用户因为输入数据量很大而需要执行长时间的map或者Reduce task的话，那么启动推测执行造成的浪费是非常巨大大。</li>
</ul>
<h4 id="g压缩">g.压缩</h4>
<p>开启Map输出阶段压缩</p>
<p>开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">）开启</span>hive中间传输数据压缩功能 
   <span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.compress.intermediate<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;
<span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">）开启</span>mapreduce中map输出压缩功能 
   <span style="color:#000;font-weight:bold">set</span> mapreduce.<span style="color:#000;font-weight:bold">map</span>.<span style="color:#000;font-weight:bold">output</span>.compress<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;
<span style="color:#099">3</span><span style="color:#a61717;background-color:#e3d2d2">）设置</span>mapreduce中map输出数据的压缩方式 
   <span style="color:#000;font-weight:bold">set</span> mapreduce.<span style="color:#000;font-weight:bold">map</span>.<span style="color:#000;font-weight:bold">output</span>.compress.codec<span style="color:#000;font-weight:bold">=</span> org.apache.hadoop.io.compress.SnappyCodec;
<span style="color:#099">4</span><span style="color:#a61717;background-color:#e3d2d2">）执行查询语句</span>
   <span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">count</span>(ename) name <span style="color:#000;font-weight:bold">from</span> emp;
</code></pre></td></tr></table>
</div>
</div><p>开启Reduce输出阶段压缩</p>
<p>当Hive将输出写入到表中时，输出内容同样可以进行压缩。属性hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这个值为true，来开启输出结果压缩功能。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">）开启</span>hive最终输出数据压缩功能
  <span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.compress.<span style="color:#000;font-weight:bold">output</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;
<span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">）开启</span>mapreduce最终输出数据压缩
  <span style="color:#000;font-weight:bold">set</span> mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;
<span style="color:#099">3</span><span style="color:#a61717;background-color:#e3d2d2">）设置</span>mapreduce最终数据输出压缩方式
  <span style="color:#000;font-weight:bold">set</span> mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress.codec <span style="color:#000;font-weight:bold">=</span> org.apache.hadoop.io.compress.SnappyCodec;
<span style="color:#099">4</span><span style="color:#a61717;background-color:#e3d2d2">）设置</span>mapreduce最终数据输出压缩为块压缩
  <span style="color:#000;font-weight:bold">set</span> mapreduce.<span style="color:#000;font-weight:bold">output</span>.fileoutputformat.compress.<span style="color:#000;font-weight:bold">type</span><span style="color:#000;font-weight:bold">=</span>BLOCK;
<span style="color:#099">5</span><span style="color:#a61717;background-color:#e3d2d2">）测试一下输出结果是否是压缩文件</span>
  <span style="color:#000;font-weight:bold">insert</span> overwrite <span style="color:#000;font-weight:bold">local</span> directory <span style="color:#d14">&#39;/opt/module/datas/distribute-result&#39;</span> 
  <span style="color:#000;font-weight:bold">select</span> <span style="color:#000;font-weight:bold">*</span> 
    <span style="color:#000;font-weight:bold">from</span> emp 
  distribute <span style="color:#000;font-weight:bold">by</span> deptno 
    sort <span style="color:#000;font-weight:bold">by</span> empno <span style="color:#000;font-weight:bold">desc</span>;
</code></pre></td></tr></table>
</div>
</div><h3 id="2hive表优化">2.Hive表优化</h3>
<h4 id="a小表大表join">a.小表、大表join</h4>
<ul>
<li>将key相对分散，并且数据量小的表放在join的左边，这样可以有效减少内存溢出错误发生的几率；再进一步，可以使用Group让小的维度表（1000条以下的记录条数）先进内存。在map端完成reduce。</li>
<li>实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放在左边和右边已经没有明显区别。</li>
</ul>
<h4 id="b大表join大表">b.大表join大表</h4>
<ol>
<li>空值过滤</li>
</ol>
<ul>
<li>有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为空。</li>
</ul>
<ol start="2">
<li>空key转换</li>
</ol>
<ul>
<li>有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地分不到不同的reducer上。</li>
</ul>
<h4 id="cmapjoin">c.MapJoin</h4>
<ul>
<li>如果不指定MapJoin或者不符合MapJoin的条件，那么Hive解析器会将Join操作转换成Common Join，即：在Reduce阶段完成join。容易发生数据倾斜。可以用MapJoin把小表全部加载到内存在map端进行join，避免reducer处理。</li>
<li>开启MapJoin参数设置：
<ol>
<li>设置自动选择Mapjoin</li>
</ol>
<ul>
<li>set hive.auto.convert.join = true; 默认为true</li>
</ul>
<ol start="2">
<li>大表小表的阈值设置（默认25M一下认为是小表）：</li>
</ol>
<ul>
<li>set hive.mapjoin.smalltable.filesize=25000000;</li>
</ul>
</li>
</ul>
<h4 id="dgroup-by">d.Group By</h4>
<ul>
<li>默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜了。</li>
<li>并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行部分聚合，最后在Reduce端得出最终结果。</li>
</ul>
<ol>
<li>开启Map端聚合参数设置</li>
</ol>
<ul>
<li>
<p>是否在Map端进行聚合，默认为True<br>
<code>hive.map.aggr = true</code></p>
</li>
<li>
<p>在Map端进行聚合操作的条目数目<br>
<code>hive.groupby.mapaggr.checkinterval = 100000</code></p>
</li>
<li>
<p>有数据倾斜的时候进行负载均衡（默认是false）<br>
<code>hive.groupby.skewindata = true</code></p>
</li>
<li>
<p>当选项设定为 true，生成的查询计划会有两个MR Job。第一个MR Job中，Map的输出结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果是相同的Group By Key有可能被分发到不同的Reduce中，从而```达到负载均衡的目的；第二个MR Job再根据预处理的数据结果按照Group By Key分布到Reduce中（这个过程可以保证相同的Group By Key被分布到同一个Reduce中），最后完成最终的聚合操作。</p>
</li>
</ul>
<h4 id="ecountdistinct-去重统计">e.Count(Distinct) 去重统计</h4>
<ul>
<li>数据量小的时候无所谓，数据量大的情况下，由于COUNT DISTINCT操作需要用一个Reduce Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，一般COUNT DISTINCT使用先GROUP BY再COUNT的方式替换。</li>
</ul>
<h4 id="f笛卡儿积">f.笛卡儿积</h4>
<ul>
<li>尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用1个reducer来完成笛卡尔积。</li>
</ul>
<h4 id="g行列过滤">g.行列过滤</h4>
<ul>
<li>列处理：在SELECT中，只拿需要的列，如果有，尽量使用分区过滤，少用SELECT *。</li>
<li>行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，那么就会先全表关联，之后再过滤。</li>
</ul>
<h3 id="3hive数据倾斜解决">3.Hive数据倾斜解决</h3>
<h2 id="hive中传入变量的方式">Hive中传入变量的方式</h2>
<ol>
<li>暴力替换</li>
</ol>
<ul>
<li>字符串替换</li>
<li>正则替换</li>
<li>模板引擎</li>
</ul>
<ol start="2">
<li>系统环境变量</li>
</ol>
<ul>
<li>shell环境变量：${env:varname}</li>
<li>system系统变量：${system:varname}</li>
</ul>
<ol start="3">
<li>hive 命令参数</li>
</ol>
<ul>
<li>hivevar方式：${hivevar:varname}</li>
<li>hiveconf方式：${hiveconf:varname}</li>
</ul>
<h3 id="hive接收外部变量方式详解">hive接收外部变量方式详解</h3>
<ul>
<li>使用Hive编写程序最常用的方法是将Hive语句写到文件中，然后使用hive -f filename.hql来批量执行查询语句。经常需要将外部参数传入到hql语句中替换其中的变量来动态执行任务，比如动态设定数据库名、表名、时间值、字段序列等变量，以达到脚本泛化执行的目的。</li>
<li>在使用hive开发数据分析代码时，经常会遇到需要改变运行参数的情况，比如select语句中对日期字段值的设定，可能不同时间想要看不同日期的数据，这就需要能动态改变日期的值。如果开发量较大、参数多的话，使用变量来替代原来的字面值非常有必要，对传入的方式进行总结。</li>
</ul>
<h3 id="1-shell中设置变量hive--e中直接使用">1-shell中设置变量，hive -e中直接使用</h3>
<p>测试脚本</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span><span style="color:#008080">tablename</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;student&#34;</span>
<span style="color:#008080">limitcount</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;8&#34;</span>
hive -S -e <span style="color:#d14">&#34;use test; select * from </span><span style="color:#d14">${</span><span style="color:#008080">tablename</span><span style="color:#d14">}</span><span style="color:#d14"> limit </span><span style="color:#d14">${</span><span style="color:#008080">limitcount</span><span style="color:#d14">}</span><span style="color:#d14">;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>可以正常运行</li>
<li>由于hive自身是类SQL语言，缺乏shell的灵活性和对过程的控制能力，所以采用shell+hive的开发模式非常常见，在shell中直接定义变量，在hive -e语句中就可以直接引用；</li>
</ul>
<p>注意</p>
<ul>
<li>注意：使用 hiveconf 定义，在hive -e中是不能使用的</li>
<li>修改一下刚才的shell文件，采用-hiveconf的方法定义日期参数：</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span><span style="color:#008080">tablename</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;student&#34;</span>
<span style="color:#008080">limitcount</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;8&#34;</span>
 
hive -S <span style="color:#d14">\
</span><span style="color:#d14"></span>    -hiveconf <span style="color:#008080">enter_school_date</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;20130902&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>    -hiveconf <span style="color:#008080">min_age</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;26&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>    -e <span style="color:#d14">\
</span><span style="color:#d14"></span>    <span style="color:#d14">&#34;    use test; \
</span><span style="color:#d14">        select * from </span><span style="color:#d14">${</span><span style="color:#008080">tablename</span><span style="color:#d14">}</span><span style="color:#d14"> \
</span><span style="color:#d14">        where \
</span><span style="color:#d14">            pdate=&#39;</span><span style="color:#d14">${</span><span style="color:#008080">hiveconf</span>:<span style="color:#008080">enter_school_date</span><span style="color:#d14">}</span><span style="color:#d14">&#39; \
</span><span style="color:#d14">            and \
</span><span style="color:#d14">            sage&gt;&#39;</span><span style="color:#d14">${</span><span style="color:#008080">hiveconf</span>:<span style="color:#008080">min_age</span><span style="color:#d14">}</span><span style="color:#d14">&#39; \
</span><span style="color:#d14">        limit </span><span style="color:#d14">${</span><span style="color:#008080">limitcount</span><span style="color:#d14">}</span><span style="color:#d14">;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>运行会失败，因为该脚本在shell环境中运行的，于是shell试图去解析{hiveconf:enter_school_date}和${hiveconf:min_age}变量，但是这两个SHELL变量并没有定义，所以会以空字符串放在这个位置。</li>
</ul>
<h3 id="2使用-hiveconf定义在sql文件中使用">2.使用-hiveconf定义，在SQL文件中使用</h3>
<ul>
<li>因为换行什么的很不方便，hive -e只适合写少量的SQL代码，所以一般都会写很多hql文件，然后使用hive –f 的方法来调用，这时候可以通过-hiveconf定义一些变量，然后在SQL中直接使用。</li>
<li>先编写shell文件</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash 
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>hive -hiveconf <span style="color:#008080">enter_school_date</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;20130902&#34;</span> -hiveconf <span style="color:#008080">min_ag</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;26&#34;</span> -f testvar.sql
</code></pre></td></tr></table>
</div>
</div><p>被调用脚本</p>
<pre><code class="language-hivesql" data-lang="hivesql">use test;
select * 
 from student
where pdate='${hiveconf:enter_school_date}'
  and sage &gt; '${hiveconf:min_ag}'
limit 8;
</code></pre><h3 id="3使用hivevar再sql文件中使用">3.使用hivevar，再sql文件中使用</h3>
<ul>
<li>在hql脚本中写使用set hivevar:varname的方式</li>
<li>定义脚本</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>hive -f testvar.sql
</code></pre></td></tr></table>
</div>
</div><p>sql脚本</p>
<pre><code class="language-hivesql" data-lang="hivesql">use test;
set hivevar:center_school_date=&quot;20130920&quot;;
set hivevar:min_age=&quot;26&quot;;
select * 
  from student
 where pdate='${hivevar:enter_school_date}'
   and sage &gt; '${hivevar:min_ag}'
 limit 8;
</code></pre><h2 id="hive动态分区参数配置">Hive动态分区参数配置</h2>
<ul>
<li>往hive分区表中插入数据时，如果需要创建的分区很多，比如以表中某个字段进行分区存储，则需要复制粘贴修改很多sql去执行，效率低。因为hive是批处理系统，所以hive提供了一个动态分区功能，其可以基于查询参数的位置去推断分区的名称，从而建立分区。</li>
</ul>
<h3 id="使用动态分区表必须配置的参数">使用动态分区表必须配置的参数</h3>
<ul>
<li>set hive.exec.dynamic.partition =true（默认false）,表示开启动态分区功能；</li>
<li>set hive.exec.dynamic.partition.mode = nonstrict(默认strict),表示允许所有分区都是动态的，否则必须有静态分区字段；</li>
</ul>
<h3 id="动态分区相关调优参数">动态分区相关调优参数</h3>
<ul>
<li>set hive.exec.max.dynamic.partitions.pernode=100 （默认100，一般可以设置大一点，比如1000）； 表示每个maper或reducer可以允许创建的最大动态分区个数，默认是100，超出则会报错。</li>
<li>set hive.exec.max.dynamic.partitions =1000(默认值) ； 表示一个动态分区语句可以创建的最大动态分区个数，超出报错；</li>
<li>set hive.exec.max.created.files =10000(默认) 全局可以创建的最大文件个数，超出报错。</li>
</ul>
<h2 id="动态分区表实践">动态分区表实践</h2>
<p>默认已经hive的动态分区和nonstrict模式；</p>
<h3 id="1创建单一字段分区表">1.创建单一字段分区表</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">create</span> <span style="color:#000;font-weight:bold">table</span> dpartition(
  id <span style="color:#0086b3">int</span> ,
  name string 
)
partitioned <span style="color:#000;font-weight:bold">by</span>(ct string);
</code></pre></td></tr></table>
</div>
</div><h3 id="2单个字段的动态分区">2.单个字段的动态分区</h3>
<ul>
<li>以city建立动态分区</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">hive<span style="color:#000;font-weight:bold">&gt;</span>
 <span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;  <span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">开启动态分区，默认是</span><span style="color:#000;font-weight:bold">false</span>
 <span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition.<span style="color:#000;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">=</span>nonstrict; <span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">开启允许所有分区都是动态的，否则必须要有静态分区才能使用。</span>
 <span style="color:#998;font-style:italic">-- 开始抽取
</span><span style="color:#998;font-style:italic"></span> <span style="color:#000;font-weight:bold">insert</span> overwrite <span style="color:#000;font-weight:bold">table</span> dpartition
 partition(ct)
 <span style="color:#000;font-weight:bold">select</span> id ,name,city <span style="color:#000;font-weight:bold">from</span>  mytest_tmp2_p; 
</code></pre></td></tr></table>
</div>
</div><ul>
<li>要点：因为dpartition表中只有两个字段，所以当我们查询了三个字段时（多了city字段），所以系统默认以最后一个字段city为分区名，因为分区表的分区字段默认也是该表中的字段，且依次排在表中字段的最后面。所以分区需要分区的字段只能放在后面，不能把顺序弄错。如果我们查询了四个字段的话，则会报错，因为该表加上分区字段也才三个。要注意系统是根据查询字段的位置推断分区名的，而不是字段名称。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hive&gt;--查看可知，hive已经完成了以city字段为分区字段，实现了动态分区。
hive <span style="color:#000;font-weight:bold">(</span>fdm_sor<span style="color:#000;font-weight:bold">)</span>&gt; show partitions dpartition;
partition
<span style="color:#008080">ct</span><span style="color:#000;font-weight:bold">=</span>beijing
<span style="color:#008080">ct</span><span style="color:#000;font-weight:bold">=</span>beijing1
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意：使用，insert&hellip;select 往表中导入数据时，查询的字段个数必须和目标的字段个数相同，不能多，也不能少,否则会报错。但是如果字段的类型不一致的话，则会使用null值填充，不会报错。而使用load data形式往hive表中装载数据时，则不会检查。如果字段多了则会丢弃，少了则会null值填充。同样如果字段类型不一致，也是使用null值填充。</li>
</ul>
<h3 id="3多个分区字段实现半自动分区">3.多个分区字段，实现半自动分区</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">1.创建一个只有一个字段，两个分区字段的分区表
hive <span style="color:#000;font-weight:bold">(</span>fdm_sor<span style="color:#000;font-weight:bold">)</span>&gt; create table ds_parttion<span style="color:#000;font-weight:bold">(</span>id int <span style="color:#000;font-weight:bold">)</span> 
              &gt; partitioned by <span style="color:#000;font-weight:bold">(</span>state string ,ct string <span style="color:#000;font-weight:bold">)</span>;
2.往该分区表半动态分区插入数据 
hive&gt;
 <span style="color:#0086b3">set</span> hive.exec.dynamic.partition<span style="color:#000;font-weight:bold">=</span>true;
 <span style="color:#0086b3">set</span> hive.exec.dynamic.partition.mode<span style="color:#000;font-weight:bold">=</span>nonstrict;
 insert overwrite table ds_parttion
 partition<span style="color:#000;font-weight:bold">(</span><span style="color:#008080">state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;china&#39;</span>,ct<span style="color:#000;font-weight:bold">)</span>  <span style="color:#998;font-style:italic">#state分区为静态，ct为动态分区，以查询的city字段为分区名</span>
 <span style="color:#000;font-weight:bold">select</span> id ,city from  mytest_tmp2_p; 
 
3.查询结果显示：
hive <span style="color:#000;font-weight:bold">(</span>fdm_sor<span style="color:#000;font-weight:bold">)</span>&gt; <span style="color:#000;font-weight:bold">select</span> *  from ds_parttion where <span style="color:#008080">state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;china&#39;</span>
              &gt; ;
ds_parttion.id  ds_parttion.state       ds_parttion.ct
<span style="color:#099">4</span>       china   beijing
<span style="color:#099">3</span>       china   beijing
<span style="color:#099">2</span>       china   beijing
<span style="color:#099">1</span>       china   beijing
<span style="color:#099">4</span>       china   beijing1
<span style="color:#099">3</span>       china   beijing1
<span style="color:#099">2</span>       china   beijing1
<span style="color:#099">1</span>       china   beijing1
 
hive <span style="color:#000;font-weight:bold">(</span>fdm_sor<span style="color:#000;font-weight:bold">)</span>&gt; <span style="color:#000;font-weight:bold">select</span> *  from ds_parttion where <span style="color:#008080">state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;china&#39;</span> and <span style="color:#008080">ct</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;beijing&#39;</span>;
ds_parttion.id  ds_parttion.state       ds_parttion.ct
<span style="color:#099">4</span>       china   beijing
<span style="color:#099">3</span>       china   beijing
<span style="color:#099">2</span>       china   beijing
<span style="color:#099">1</span>       china   beijing
 
hive <span style="color:#000;font-weight:bold">(</span>fdm_sor<span style="color:#000;font-weight:bold">)</span>&gt; <span style="color:#000;font-weight:bold">select</span> *  from ds_parttion where <span style="color:#008080">state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;china&#39;</span> and <span style="color:#008080">ct</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;beijing1&#39;</span>;
ds_parttion.id  ds_parttion.state       ds_parttion.ct
<span style="color:#099">4</span>       china   beijing1
<span style="color:#099">3</span>       china   beijing1
<span style="color:#099">2</span>       china   beijing1
<span style="color:#099">1</span>       china   beijing1
Time taken: 0.072 seconds, Fetched: <span style="color:#099">4</span> row<span style="color:#000;font-weight:bold">(</span>s<span style="color:#000;font-weight:bold">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="4多个分区字段全部实现动态分区插入">4.多个分区字段，全部实现动态分区插入</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">true</span>;
<span style="color:#000;font-weight:bold">set</span> hive.<span style="color:#000;font-weight:bold">exec</span>.<span style="color:#000;font-weight:bold">dynamic</span>.partition.<span style="color:#000;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">=</span>nonstrict;
<span style="color:#000;font-weight:bold">insert</span> overwrite <span style="color:#000;font-weight:bold">table</span> ds_parttion
partition(<span style="color:#000;font-weight:bold">state</span>,ct)
<span style="color:#000;font-weight:bold">select</span> id ,country,city <span style="color:#000;font-weight:bold">from</span>  mytest_tmp2_p; 
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意:字段的个数和顺序不能弄错。</li>
<li>注意:动态分区字段的顺序</li>
</ul>
<p>作者：李小李的路
链接：https://www.jianshu.com/p/94d4078453ab
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="../../post/%E5%A4%A7%E6%95%B0%E6%8D%AE-002hadoop%E4%B9%8Byarn%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">大数据002hadoop之yarn基础知识</a></li>
        
        <li><a href="../../post/%E5%A4%A7%E6%95%B0%E6%8D%AE-001hadoop%E4%B9%8Bhdfs%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">大数据001hadoop之hdfs基础知识</a></li>
        
        <li><a href="../../post/%E5%A4%A7%E6%95%B0%E6%8D%AE-003hive%E6%A6%82%E5%BF%B5%E5%8E%9F%E7%90%86/">大数据003hive概念原理</a></li>
        
        <li><a href="../../post/%E5%A4%A7%E6%95%B0%E6%8D%AE-001hadoop%E4%B9%8Bhdfs%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">大数据 001hadoop之hdfs常用操作</a></li>
        
        <li><a href="../../post/%E5%A4%A7%E6%95%B0%E6%8D%AE-003hive%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3/">大数据003hive优化相关</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "liuzhongzhen/liuzhongzhen.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://liuzhongzhen.github.io/">Liuzhongzhen的博客 By liuzhongzhen</a>
        
    </div>
    <br />
    <div style="display:none;">
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='../../js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='../../js/douban.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://liuzhongzhen.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://liuzhongzhen.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E7%BD%91%E7%BB%9C-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Linux%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B/" title="网络 深入理解Linux五种IO模型">网络 深入理解Linux五种IO模型</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-015%E8%BF%90%E7%BB%B4%E7%AE%A1%E7%90%86/" title="大数据 015运维管理">大数据 015运维管理</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-014zookeeper%E4%BB%8B%E7%BB%8D/" title="大数据 014zookeeper介绍">大数据 014zookeeper介绍</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-012%E6%95%B0%E6%8D%AE%E9%9B%86%E6%88%90%E8%B0%83%E7%A0%94/" title="大数据012数据集成调研">大数据012数据集成调研</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-006impala%E4%B8%8Ehive%E5%AF%B9%E6%AF%94%E8%AF%A6%E8%A7%A3/" title="大数据006impala与hive对比详解">大数据006impala与hive对比详解</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-009kafka%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="大数据009kafka基础知识">大数据009kafka基础知识</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-007clickhouse%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="大数据007clickhouse基础知识">大数据007clickhouse基础知识</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-006impala%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="大数据006impala基础知识">大数据006impala基础知识</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-005flink%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="大数据005flink基础知识">大数据005flink基础知识</a>
    </li>
    
    <li>
        <a href="https://liuzhongzhen.github.io/post/%E5%A4%A7%E6%95%B0%E6%8D%AE-004PySparkSQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/" title="大数据 004PySparkSQL常用函数">大数据 004PySparkSQL常用函数</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='../../categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80001%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">CS基础001数据结构 (12)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80002%E6%95%B0%E6%8D%AE%E5%BA%93/">CS基础002数据库 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80003%E7%BD%91%E7%BB%9C/">CS基础003网络 (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80004%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">CS基础004操作系统 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80005%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">CS基础005组成原理 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80006%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">CS基础006设计模式 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/CS%E5%9F%BA%E7%A1%80007%E6%95%B0%E5%AD%A6/">CS基础007数学 (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-3Proxy/">Web-3Proxy (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-Css/">Web-Css (6)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-Dns/">Web-Dns (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-HAProxy/">Web-HAProxy (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-Html/">Web-Html (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-Http/">Web-Http (8)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-JavaScript/">Web-JavaScript (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-KeepAlived/">Web-KeepAlived (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-LVS/">Web-LVS (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-Nginx/">Web-Nginx (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/Web-OpenResty/">Web-OpenResty (6)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-000%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">大数据-000数据分析 (3)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-001hadoop%E4%B9%8Bhdfs/">大数据-001hadoop之hdfs (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-002hadoop%E4%B9%8Byarn/">大数据-002hadoop之yarn (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-003hive/">大数据-003hive (6)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-004spark/">大数据-004spark (4)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-005flink/">大数据-005flink (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-006impala/">大数据-006impala (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-007clickhouse/">大数据-007clickhouse (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-008hbase/">大数据-008hbase (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-009kafka/">大数据-009kafka (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-010flume/">大数据-010flume (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-012%E6%95%B0%E6%8D%AE%E9%9B%86%E6%88%90/">大数据-012数据集成 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-014zookeeper/">大数据-014zookeeper (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-015%E8%BF%90%E7%BB%B4%E7%AE%A1%E7%90%86/">大数据-015运维管理 (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%AD%98%E5%82%A8-GlusterFS/">存储-GlusterFS (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%AD%98%E5%82%A8-MinIO/">存储-MinIO (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E5%AD%98%E5%82%A8-NFS/">存储-NFS (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93-Mysql/">数据库-Mysql (12)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计 (2)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E7%BC%93%E5%AD%98-Memcache/">缓存-Memcache (5)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E7%BC%93%E5%AD%98-Redis/">缓存-Redis (1)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E7%BD%91%E7%BB%9CPPT/">网络PPT (10)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E8%AF%AD%E8%A8%80Java/">语言Java (6)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E8%AF%AD%E8%A8%80Php/">语言Php (11)</a></li>
    
    <li><a href="https://liuzhongzhen.github.io/categories/%E8%AF%AD%E8%A8%80Python/">语言Python (2)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='../../tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://liuzhongzhen.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>